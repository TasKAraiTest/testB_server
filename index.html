<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ドメインD: CVページ</title>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MVPRTSSW');</script>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPRTSSW"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    <h1>ドメインD: コンバージョンページ</h1>

    <iframe id="atb-iframe" src="https://taskarai.github.io/testa_server/saa-helper.html" 
        width="150" height="50" frameborder="0" 
        sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin">
    </iframe>

    <div id="result" style="margin-top:20px; padding:10px; background:#eee; border:1px solid #ccc; white-space: pre-wrap; word-break: break-all;">ここに結果が表示されます</div>

    <script>
      window.addEventListener('message', function(event) {
        // 送信元がドメインAでなければ無視 (セキュリティのため必須)
        if (event.origin !== 'https://taskarai.github.io') {
          return;
        }

        // 期待通りのデータ形式か確認
        if (event.data && event.data.type === 'atb_data_ready') {
          var receivedData = event.data.data;
          
          // データを整形して見やすくする
          var formattedData = JSON.stringify(receivedData, null, 2);

          // ページ上の<div id="result">に整形したデータを表示する
          var resultDiv = document.getElementById('result');
          if (resultDiv) {
            resultDiv.textContent = formattedData;
          }
        }
      });
    </script>
</body>
</html>
